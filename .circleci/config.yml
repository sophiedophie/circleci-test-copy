defaults: &defaults
  docker:
      - image: "circleci/node:9.6.1"
  steps:
      - setup_remote_docker:
          docker_layer_caching: true
      - run: echo "started"

workflows:
  version: 2
  build_and_deploy:
    jobs:
      - build:
          filters:
            branches:
              only: master #for tests
            tags: # required since `release_api` has tag filters AND requires `build`
              only: /.*/
      - release_api:
          requires:
            - build
          filters:
            branches:
              ignore: /.*/
            tags:
              only: /^v.*/

jobs:
  build:
    <<: *defaults 
  release_api:
    <<: *defaults
